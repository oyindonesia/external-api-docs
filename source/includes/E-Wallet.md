# API E-Wallet Aggregator

E-Wallet Aggregator API allows partners to seamlessly charge and receive payments directly from top e-wallet issuers. With one integration, they are able to get access to all of OY’s available e-wallets ((OVO, ShopeePay, LinkAja, and DANA) and upcoming e-wallet integrations.

## Create E-Wallet Transaction
Use this API to create an e-wallet transaction for your user

### HTTPS Request

**[Production]** `POST https://partner.oyindonesia.com/api/e-wallet-aggregator/create-transaction ` <br/>

**[Staging]** `POST https://api-stg.oyindonesia.com/api/e-wallet-aggregator/create-transaction`

### Request Headers

Parameter | Type | Description
--------- | ---- | -------- |
X-Api-Key | String | API Key used to connect to this particular endpoint
X-Oy-Username | String | Your OY! account username

### Request Parameters

Parameter | Type | Required | Default | Description
--------- | ---- | -------- | ------- | -----------
customer_id | String(255) | TRUE | - | ID generated by Partner for a specific user/customer
sub_merchant_id | String(255) | FALSE | - | ID generated by Partner for a specific sub-merchant
partner_tx_id | String(255) | TRUE | - | ID generated by Partner for a specific transaction
amount | BigDecimal | TRUE| - | Transaction amount. Min = 1,000. Max = 10,000,000
email | String(255) | FALSE | - | Customer's email
ewallet_code | String(255) | TRUE | - | The ewallet issuer that the customer will use to pay. Refer to table "E-Wallet Details" for the list of codes
mobile_number | String(255) | CONDITIONAL | - | Customer mobile number used on their ewallet account. Only required if ewallet_code is equal to "ovo_ewallet"
redirect_url_env | String(255) | CONDITIONAL | "web" | Indicates the environment that you use to redirect the customers back once payment has been completed in e-wallet issuers. Possible values: "web" or "app". Only used if ewallet_code is equal to "dana_ewallet"
success_redirect_url | String(255) | CONDITIONAL | - | Indicates the URL of your environment (to redirect the customers back once payment has been  completed in e-wallet issuers.)  Accepts HTTP links and URL  scheme formats.  Required if ewallet_code = DANA or LINKAJA or SHOPEEPAY.
expiration_time | Long | FALSE | Maximum expiration time (in minutes) for each ewallet issuer | Expiration time of the transaction in minute  e.g If you want the transaction to be expired after 5 minutes, you just have to set expiration_time to 5.  Each ewallet type might have different expiration time rule, please see table "E-Wallet Details"

### Response Parameters

Parameter | Type | Description
--------- | ---- | -------- | 
status | Object | Status of response in Object `{code: <status_code>, message: <status_message>}`. See table "Response Code" for more details
ewallet_trx_status | String(20) | Always filled with WAITING_PAYMENT if a transaction is successfully created
trx_id | String(255) | Filled with a unique transaction identifier from OY
customer_id | String(255) | ID generated by Partner for a specific user/customer
partner_trx_id | String(255) | ID generated by Partner for a specific transaction
amount | String(255) | Transaction amount | 
ewallet_code | String(255) | The ewallet issuer that the customer will use to pay. Refer to this for the list of available ewallet codes
ewallet_url | String(255) | EWallet URL generated by the the e-wallet issuers to be used for payment purposes

## E-Wallet Transaction Callback

The E-Wallet Transaction Callback will be sent as a POST request (using JSON format) to your web hook. Please inform your Callback web hook to our business representative or to partner@oyindonesia.com

You will receive the callback when your user has successfully paid the e-wallet transaction. (Note: We send the callback ONLY for a successful transaction.

### Callback for Delayed Settlement (Non-Real Time Settlement)

If your settlement is non-real time, for every transaction whose payment method is settled H+>0 from the time of transaction, you will receive two callbacks with details as follows:

1.  1st Callback -> To be sent after your customer successfully executes the transaction. For example, if your customer executes the transaction on 11 May 2021 at 14:00:00, that is also when we send the 1st Callback to you. In the 1st callback, the settlement status is set to WAITING (because it is not yet settled to your Account Statement balance)
2.  2nd Callback -> To be sent after the settlement status is changed from WAITING into SUCCESS. For example, if the settlement status is changed into SUCCESS on 12 May 2021 at 15:00:00, that is also when we send the 2nd Callback to you. In the 2nd callback, the settlement status is SUCCESS

### Callback Parameters

Parameter | Type | Description
--------- | ---- | -------- | 
success | boolean | The status of the payment and it is always set to to true
partner_trx_id  | String(255) | ID generated by Partner for a specific transaction
trx_id | String(255) | Filled with a unique transaction identifier from OY
customer_id | String(255) | ID generated by Partner for a specific user/customer
amount | BigDecimal | Transaction amount
ewallet_code | String(255) | The ewallet issuer that the customer used to pay. Refer to this for the list of available ewallet codes
mobile_number | String(255) | Customer mobile number 
success_redirect_url | String(255) | Indicates the URL of your environment (to redirect the customers back once payment has been  completed in e-wallet issuers.)
settlement_time | Timestamp | The timestamp (in UTC+7) indicating when the fund will be settled to partner’s account statement, format `dd/MM/yyyy'T'HH:mm:ss.SSSZZZZ`
settlement_status | String(255) | Status of the settlement (e.g. success/waiting)

## Check E-Wallet Transaction Status
Use this API to check the status of an e-wallet transaction.

### HTTPS Request

**[Production]** `POST https://partner.oyindonesia.com/api/e-wallet-aggregator/check-status ` <br/>

**[Staging]** `POST https://api-stg.oyindonesia.com/api/e-wallet-aggregator/check-status`

### Request Headers

Parameter | Type | Description
--------- | ---- | -------- |
X-Api-Key | String | API Key used to connect to this particular endpoint
X-Oy-Username | String | Your OY! account username

### Request Parameters

Parameter | Type | Required | Default | Description
--------- | ---- | -------- | ------- | -----------
partner_trx_id | String(255) | TRUE | - | ID generated by Partner for a specific transaction

### Response Parameters

Parameter | Type | Description
--------- | ---- | -------- | 
status | Object | Status of response in Object `{code: <status_code>, message: <status_message>}`
ewallet_trx_status | String(20) | Current transaction status, refer to "E-Wallet Transaction Status" for more details
trx_id | String(255) | Filled with a unique transaction identifier from OY
customer_id | String(255) | ID generated by Partner for a specific user/customer
partner_trx_id | String(255) | ID generated by Partner for a specific transaction
amount | String(255) | Transaction Amount
ewallet_code | String(255) | The ewallet issuer that the customer will use to pay.
ewallet_url | String(255) | EWallet URL passed from the e-wallet issuers to be used for payment purposes

## E-Wallet Details

E-Wallet Issuer | E-Wallet Code| Minimum Expiration Time | Maximum Expiration Time | Redirection Feature
--------- | ---- | -------- | ------- | ------- |
OVO | ovo_ewallet | Parameter is ignored, always set to 55 seconds | Parameter is ignored, always set to 55 seconds | Not supported
ShopeePay | shopeepay_ewallet | 1 minute | 60 minutes | Support
Linkaja | linkaja_ewallet | Parameter is ignored, always set to 5 minutes | Parameter is ignored, always set to 5 minutes | Support
DANA | dana_ewallet | 1 minute | 60 minutes | Support

## E-Wallet Transaction Status

Status | Trigger|
--------- | ---- |
WAITING_PAYMENT | Transaction is successfully created and currently active
FAILED | Payment failed
COMPLETE | Payment successfully received
REFUNDED | Payment successfully refunded
EXPIRED | Expiration time is reached with no payment received

## List of Status Codes

### Create E-Wallet Transaction

(Coming Soon)

### Check E-Wallet Transaction Status

(Coming Soon)























