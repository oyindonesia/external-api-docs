# Virtual Account (VA) Aggregator

Our API VA Aggregator product will significantly save the cost and time needed for reporting and reconciling payments received through various banks. 

It provides you with the capabilities to create unique Virtual Account (VA) numbers as a bank transfer payment method for your customers while the fund movements take place through OY!'s physical account.  
You donâ€™t have to open a bank account with each respective bank - all you need to do is to integrate with our API VA Aggregator and you will have centralized access to the VAs across multiple banks.

### VA Aggregator API Base URL

**[Production Base URL]**: `<%= config[:endpoint_prod] %>`<br/>
**[Staging Base URL]**: `<%= config[:endpoint_stg] %>`

## Create VA

This API endpoint can be used to create a new VA number.

```shell
curl -X \
POST <%= config[:endpoint_prod] %>/api/generate-static-va
-H 'content-type: application/json' \
-H 'accept: application/json' \
-H 'x-oy-username: username' \
-H 'x-api-key: apikey' \
-d '{
    "partner_user_id":"51200021",
    "bank_code": "002",
    "amount": 0,
    "is_open": true,
    "is_single_use" : false,
    "is_lifetime": false,
    "expiration_time": 5,
    "username_display": "va name",
    "email": "email@mail.com",
    "trx_expiration_time": 5,
    "partner_trx_id": "TRX0001",
    "trx_counter" : 1
}'
```

> The above command returns JSON structured similar like this:

```json
{
    "id": "12345b1-23be-45670-a123-5ca678f12b3e",
    "status": {
        "code": "000",
        "message": "Success"
    },
    "amount": 500000,
    "va_number": "123456789182827272",
    "bank_code": "002",
    "is_open": false,
    "is_single_use": false,
    "expiration_time": 1582783668175,
    "va_status": "WAITING_PAYMENT",
    "username_display": "va name",
    "trx_expiration_time": 1582783668175,
    "partner_trx_id": "TRX0001",
    "trx_counter": 1
}
```

### HTTPS Request
**[Production]** `POST <%= config[:endpoint_prod] %>/api/generate-static-va` <br/>
**[Staging]** `POST <%= config[:endpoint_stg] %>/api/generate-static-va`

### Request Parameters

Parameter | Type | Required | Default | Description
--------- | ---- | -------- | ------- | -----------
partner_user_id | String(255) | TRUE | - | A unique ID of your choice for a specific user
bank_code | String(3) | TRUE | - | Bank code of the virtual account you want to create. Refer to [this section](https://api-docs.oyindonesia.com/#va-aggregator-bank-code) for the list of available bank codes
amount | BigDecimal | FALSE | 0 | The amount that the virtual account will accept.  If is_open is false, amount is mandatory to be specified.
is_open | Boolean | FALSE | true | When set to `true`, the VA will be open and, therefore, can accept any amount (field `amount` can be optional). When set to `false`, the VA will be closed and, therefore, only accepts the amount specified in `amount` field (mandatory to be specified).
is_single_use | Boolean | FALSE | false | When set to `true`, the VA will be inactive/closed and the status will change to `COMPLETED` after it is successfully paid
expiration_time | Long | FALSE | - | Expiration time of the VA (in minutes). e.g if VA wants to be expired after 5 minutes, you just have to set expiration_time to 5. If empty, VA will expire in 24 hours
is_lifetime | Boolean | FALSE | FALSE | When set to `false` (default) then VA will expire based on the expiration time. Otherwise, it will remain active.
username_display | String(255) | FALSE | username | Customizable VA display name that will be seen by user (displayed in bank's user interface, e.g. ATM confirmation screens, mobile banking UI). If empty, we will display the username of your OY! account
email | String(50) | FALSE | - | Email of your user - using email standard format
trx_expiration_time | Long | FALSE | - | Transaction expiration time (in minutes), e.g If transaction want to be expired after 5 minutes, you just have to set expiration_time to 5. If empty, transaction expiration time will be the same with VA expiration time
partner_trx_id | String(255) | FALSE | - | A unique ID of your choice for a specific transaction ID
trx_counter | Int | FALSE | -1/1 | Transaction counter to limit the number of transaction that can be received by a VA number. If empty, default value -1 will be used for multiple use VA (is_single_use set to `false`) and default value 1 will be used for single use VA (is_single_use set to `true`). If counter reach zero, va cannot be inquiry or accept payment.

### Response Parameters

Parameter | Type | Description
--------- | ---- | -----------
status | Object | Status of response in Object `{code: <status_code>, message: <status_message>}`
amount | BigDecimal | Amount of VA transaction
va_number | String(20) | Generated VA number
id | String(36) | Unique VA ID
partner_user_id | String(255) | A unique ID of your choice for a specific user
bank_code | String(3) | Bank code of the virtual account you want to create. Refer to [this section](https://api-docs.oyindonesia.com/#va-aggregator-bank-code) for the list of available bank codes
is_open | Boolean | When set to `true`, the VA will be open and, therefore, can accept any amount (field `amount` can be optional). When set to `false`, the VA will be closed and, therefore, only accepts the amount specified in `amount` field (mandatory to be specified).
is_single_use | Boolean | When set to `true`, the VA will be inactive/closed and the status will change to `COMPLETED` after it is successfully paid
expiration_time | Long | Expiration time of VA on Unix timestamp in milliseconds, -1 means no expiration time.
va_status | String(16) | Status of VA, see [VA Status](#static-va-status)
username_display | String(255) | Customizable VA display name that will be seen by user (displayed in bank's user interface, e.g. ATM confirmation screens, mobile banking UI). If empty, we will display the username of your OY! account
trx_expiration_time | Long | Transaction expiration time on Unix timestamp in milliseconds, -1 means no expiration time.
partner_trx_id | String(255) | A unique ID of your choice for a specific transaction ID
trx_counter | Int | Transaction counter to limit the number of transaction that can be received by a VA number. If empty, default value -1 will be used for multiple use VA (is_single_use set to `false`) and default value 1 will be used for single use VA (is_single_use set to `true`). If counter reaches zero, the VA can no longer be inquired or paid by the user.

  ## Get VA Info

This API endpoint can be used to get an information corresponding to a specific VA number (based on a unique VA ID).

```shell
curl -X \
GET <%= config[:endpoint_prod] %>/api/static-virtual-account/1414255-12121-21212121-212121
-H 'content-type: application/json' \
-H 'accept: application/json' \
-H 'x-oy-username: username' \
-H 'x-api-key: apikey'
```

> The above command returns JSON structured similar like this:

```json
{
    "id": "1414255-12121-21212121-212121",
    "status": {
        "code": "000",
        "message": "Success"
    },
    "amount": 10000.0000,
    "va_number": "1233456000000000001",
    "bank_code": "002",
    "is_open": true,
    "is_single_use": false,
    "expiration_time": 1582790250609,
    "va_status": "WAITING_PAYMENT",
    "username_display": "username",
    "amount_detected": 0,
    "partner_user_id": "123456",
    "trx_expiration_time": 1582790250609,
    "partner_trx_id": "TRX0001",
    "trx_counter": -1
}
```

### HTTPS Request
**[Production]** `GET <%= config[:endpoint_prod] %>/api/static-virtual-account/<ID>` <br/>
**[Staging]** `GET <%= config[:endpoint_stg] %>/api/static-virtual-account/<ID>`

### URL Parameters

Parameter | Type | Required | Default | Description
--------- | ---- | -------- | ------- | -----------
ID | String(255) | TRUE | - | Unique VA ID (you can get VA ID after you successfully create a new VA number)
  
### Response Parameters

Parameter | Type | Description
--------- | ---- | -----------
id | String |  Unique VA id
status | Object | Status of response in Object `{code: <status_code>, message: <status_message>}`
amount | BigDecimal | Amount of VA transaction
va_number | String(20) | Generated VA number
bank_code | String(3) | Bank code of the VA
is_open | Boolean | When set to `true`, the VA will be open and, therefore, can accept any amount (field `amount` can be optional). When set to `false`, the VA will be closed and, therefore, only accepts the amount specified in `amount` field (mandatory to be specified).
is_single_use | Boolean | When set to `true`, the VA will be inactive/closed and the status will change to `COMPLETED` after it is successfully paid
expiration_time | Long | Expiration time of VA on Unix timestamp in milliseconds, -1 means no expiration time.
va_status | String(16) | Status of VA, see [VA Status](#static-va-status)
username_display | String(255) | Customizable VA display name that will be seen by user (displayed in bank's user interface, e.g. ATM confirmation screens, mobile banking UI). If empty, we will display the username of your OY! account
partner_user_id | String(255) | A unique ID of your choice for a specific user
trx_expiration_time | Long | Transaction expiration time on Unix timestamp in milliseconds, -1 means no expiration time.
partner_trx_id | String(255) | A unique ID of your choice for a specific transaction ID
trx_counter | Int | Transaction counter to limit the number of transaction that can be received by a VA number. If empty, default value -1 will be used for multiple use VA (is_single_use set to `false`) and default value 1 will be used for single use VA (is_single_use set to `true`). If counter reaches zero, the VA can no longer be inquired or paid by the user.

## Update VA

This API endpoint can be used to update the attributes corresponding to a VA number (based on a unique VA ID).
  
Attributes that can be updated:

* amount
* is_single_use
* email
* trx_counter
* expired_time
* trx_expired_time
* username_display

Example:
* A static VA with a closed amount can be updated with a new closed amount hence it can work as a bill to be paid for a particular customer
* A static VA can be updated to a single use so it will be the last payment received from a particular customer
* A dynamic VA with a closed amount is updated to an opened amount so that it can accept payments for any amount

```shell
curl -X \
PUT <%= config[:endpoint_prod] %>/api/static-virtual-account/1414255-12121-21212121-212121
-H 'content-type: application/json' \
-H 'accept: application/json' \
-H 'x-oy-username: username' \
-H 'x-api-key: apikey' \
-d '{
    "is_open": true,
    "amount": 50000,
    "is_single_use": false,
    "expiration_time": 30,
    "username_display": "test",
    "bank_code": "002",
    "trx_expiration_time":5,
    "partner_trx_id":"TRX0002",
    "trx_counter": 1
}'
```

```json
{
    "id": "1414255-12121-21212121-212121",
    "status": {
        "code": "000",
        "message": "Success"
    },
    "amount": 50000,
    "va_number": "1001234000000000001",
    "bank_code": "002",
    "is_open": true,
    "is_single_use": false,
    "expiration_time": 1582802205412,
    "va_status": "WAITING_PAYMENT",
    "username_display": "vaname",
    "partner_user_id": "12345677",
    "trx_expiration_time": 1582802205412,
    "partner_trx_id": "TRX0002",
    "trx_counter": 1
}
```

### HTTPS Request
**[Production]** `PUT <%= config[:endpoint_prod] %>/api/static-virtual-account/<ID>` <br/>
**[Staging]** `PUT <%= config[:endpoint_stg] %>/api/static-virtual-account/<ID>`

### URL Parameter
Parameter | Type | Required | Default | Description
--------- | ---- | -------- | ------- | -----------
ID | String(36) | TRUE | - | Unique VA ID (you can get VA ID after you successfully create a new VA number)
  
### Request Parameters

Parameter | Type | Required | Default | Description
--------- | ---- | -------- | ------- | -----------
amount | BigDecimal | FALSE | - | The amount that the virtual account will accept.  If is_open is false, amount is mandatory to be specified.
is_single_use | Boolean | FALSE | false | When set to true, the VA will be inactive/closed and the status will change to COMPLETED after it is successfully paid
expiration_time | Long | FALSE | - | Expiration time of the VA (in minutes). e.g if VA wants to be expired after 5 minutes, you just have to set expiration_time to 5. If empty, VA will expire in 24 hours
username_display | String | - | - | Customizable VA display name that will be seen by user (displayed in bank's user interface, e.g. ATM confirmation screens, mobile banking UI). If empty, we will display the username of your OY! account
is_lifetime | Boolean | FALSE | - | false | When set to false (default) then VA will expire based on the expiration time. Otherwise, it will remain active.
email | String(50) | FALSE | - | Email of user, using email standard format
trx_expiration_time | Long | FALSE | - | Transaction expiration time (in minutes), e.g If transaction want to be expired after 5 minutes, you just have to set expiration_time to 5. If empty, transaction expiration time will be the same with VA expiration time
partner_trx_id | String(255) | - | Partner unique Transaction ID of a VA
trx_counter | Int | FALSE | -1/1 | Transaction counter to limit the number of transaction that can be received by a VA number. If empty, default value -1 will be used for multiple use VA (is_single_use set to false) and default value 1 will be used for single use VA (is_single_use set to true). If counter reaches zero, the VA can no longer be inquired or paid by the user.


### Response Parameters

Parameter | Type | Description
--------- | ---- | -----------
id | String | Unique VA ID (you can get VA ID after you successfully create a new VA number)
status | Object | Status of response in Object {code: <status_code>, message: <status_message>}
amount | BigDecimal | Amount of VA transaction
va_number | String(20) | Generated VA number
bank_code | String(3) | Bank code of VA
is_open | Boolean | When set to true, the VA will be open and, therefore, can accept any amount (field amount can be optional). When set to false, the VA will be closed and, therefore, only accepts the amount specified in amount field (mandatory to be specified).
is_single_use | Boolean | When set to true, the VA will be inactive/closed and the status will change to COMPLETED after it is successfully paid
expiration_time | Long | Expiration time of VA on Unix timestamp in milliseconds, -1 means no expiration time.
va_status | String(16) | Status of VA, see [VA Status](#static-va-status)
username_display | String(255) | Customizable VA display name that will be seen by user (displayed in bank's user interface, e.g. ATM confirmation screens, mobile banking UI). If empty, we will display the username of your OY! account
partner_user_id | String(255) | A unique ID of your choice for a specific user
trx_expiration_time | Long | Transaction expiration time on Unix timestamp in milliseconds, -1 means no expiration time.
partner_trx_id | String(255) | A unique ID of your choice for a specific transaction ID
trx_counter | Int | Transaction counter to limit the number of transaction that can be received by a VA number. If empty, default value -1 will be used for multiple use VA (is_single_use set to false) and default value 1 will be used for single use VA (is_single_use set to true). If counter reaches zero, the VA can no longer be inquired or paid by the user.
counter_incoming_payment | Integer | Count of total incoming payment for the VA

## Get List of Created VA

This API endpoint can be used to get the list of created VA.

```shell
curl -X \
GET <%= config[:endpoint_prod] %>/api/static-virtual-account?offset=0&limit=10
-H 'content-type: application/json' \
-H 'accept: application/json' \
-H 'x-oy-username: username' \
-H 'x-api-key: apikey'
```

> The above command returns JSON structured similar like this:

```json
{
    "total": 5,
    "data": [
        {
            "id": "9a660428-3373-436b-b929-ef69698dd26f",
            "amount": 12000.0000,
            "va_number": "100536000000000006",
            "bank_code": "002",
            "is_open": true,
            "is_single_use": false,
            "expiration_time": 1582791896416,
            "va_status": "EXPIRED",
            "username_display": "username",
            "amount_detected": 400000,
            "partner_user_id": "12345",
            "trx_expiration_time": 1582802205412,
            "partner_trx_id": "TRX0002"
        },
        {
            "id": "de51383f-1557-409c-8542-dcb74ca76375",
            "amount": 12000.0000,
            "va_number": "100536000000000005",
            "bank_code": "002",
            "is_open": true,
            "is_single_use": false,
            "expiration_time": 1582790250609,
            "va_status": "EXPIRED",
            "username_display": "username",
            "amount_detected": 500000,
            "partner_user_id": "54321",
            "trx_expiration_time": 1582802205412,
            "partner_trx_id": "TRX0002"
        }
    ],
    "status": {
        "code": "000",
        "message": "Success"
    }
}
```

### HTTPS Request
**[Production]** `GET <%= config[:endpoint_prod] %>/api/static-virtual-account?offset=<offset>&limit=<limit>` <br/>
**[Staging]** `GET <%= config[:endpoint_stg] %>/api/static-virtual-account?offset=<offset>&limit=<limit>`

### Request Parameters
Parameter | Type | Default | Description
--------- | ---- | ------- | -----------
offset | Integer | 0 | Start offset. If empty, default value will be used
limit | Integer | 10 | Max item to fetch. If empty, default value will be used


### Response Parameters
Parameter | Type | Description
--------- | ---- | -----------
total | Integer | total items
data | Array of object | List of Object {id: <va_id>, amount: <amount>, va_number: <va_number>, bank_code: <bank_code>, bank_name: <bank_name>, is_open: <is_open>, is_single_use: <is_single_use>, expiration_time: <expiration_time>, va_status: <va_status>, username_display: <username_display>, amount_detected: <amount_detected>, partner_user_id: <partner_user_id>, created: <created>, counter_incoming_payment: <counter_incoming_payment>, trx_counter: <trx_counter>}
status | Object | Status of response in Object {code: <status_code>, message: <status_message>}


## Get List of Transaction for VA

This API endpoint can be used to get the list of incoming payment/transaction made into a specific VA number.
  
```shell
curl -X \
GET <%= config[:endpoint_prod] %>/api/va-tx-history/12345676788898?offset=0&limit=10
-H 'content-type: application/json' \
-H 'accept: application/json' \
-H 'x-oy-username: username' \
-H 'x-api-key: apikey'
```

> The above command returns JSON structured similar like this:

```json
{
    "id": "12345676788898",
    "status": {
        "code": "000",
        "message": "Success"
    },
    "data": [
        {
            "id": "d9c2963f-be14-4558-9380-5ba1db8ed156",
            "created": "2020-02-27 07:48:01",
            "name": "Static VA by username",
            "amount": 10000,
            "create_by": "Static VA by username",
            "last_update_by": "Static VA by username",
            "last_updated": 1582789681439,
            "admin_fee": 1000,
            "va_number": "123456000000000001"
        }
    ],
    "number_of_transaction": 1
}
```

### HTTPS Request
**[Production]** `GET <%= config[:endpoint_prod] %>/api/va-tx-history/<ID>?offset=<offset>&limit=<limit>` <br/>
**[Staging]** `GET <%= config[:endpoint_stg] %>/api/va-tx-history/<ID>?offset=<offset>&limit=<limit>`

### URL Parameter
Parameter | Type | Required | Default | Description
--------- | ---- | -------- | ------- | -----------
ID | String(36) | TRUE | - | Unique VA ID (you can get VA ID after you successfully create a new VA number)

### Request Parameters
Parameter | Type | Required | Default | Description
--------- | ---- | ---------- | -------- | ------- | -----------
offset | Integer | FALSE | 0 | start offset, default is 0, if empty will used default value
limit | Integer | FALSE | 10 | max item to fetch, default is 10, if empty will used default value

### Response Parameters
Parameter | Type | Description
--------- | ---- | -----------
id | Integer | Unique VA id
status | Object | Status of response in Object `{code: <status_code>, message: <status_message>}`
data  | Array of Object  | List of Object `{id: <transaction_id>, created: <created>, name: <name>, amount: <amount>, create_by: <create_by>, last_update_by: <last_update_by>, last_updated: <last_updated>, admin_fee: <admin_fee>, va_number: <va_number>, va_history_id: <va_history_id>}`
numberOfTransaction  | Integer | Total transaction
total_incoming_payment | Integer | Total incoming payment

## VA Aggregator Callback

> Response callback:

```json
{
	"va_number": "1234567",
	"amount": 100000,
	"partner_user_id": "oy0000000001",
	"success": true,
  "tx_date": "31/01/2020T01:01:01.000+0000",
  "username_display": "VA Name",
  "trx_expiration_date": "31/01/2020T01:01:01.000+0000",
  "partner_trx_id": "TRX0002",
  "trx_id": "12345-12345-12453-12455"
}
```

Once user successfully do the payment, our system will make a callback to your system

### Callback Parameters

Parameter | Type | Description
--------- | ---- | -----------
va_number | String(20) | Generated VA number
amount | BigDecimal | Amount of VA transaction
partner_user_id | String(255) | Your unique ID for specific user
success | boolean | The status of the payment and it is always set to SUCCESS
tx_date | Timestamp | Incoming payment transaction date, UTC format dd/MM/yyyy'T'HH:mm:ss.SSSZZZZ
username_display | String(255) | Customizable VA display name that will be seen by user, If empty willl be using partner username
trx_expiration_date | Long | Transaction expiration date, UTC format dd/MM/yyyy'T'HH:mm:ss.SSSZZZZ
partner_trx_id | String(255) | Partner unique Transaction ID for specific transaction
trx_id | String (255) | Unique ID of incoming payment


## VA aggregator Bank Code
### Available Bank for VA aggregator
Bank Code | Bank Name
--------- | ---------
002 | Bank BRI
013 | Bank Permata
022 | Bank CIMB Niaga
008 | Bank Mandiri
009 | Bank BNI
014 | Bank BCA
  
## Required Documents for VA BCA Activation
To create and enable payment through BCA VA, you are required to submit additional documents to our business representative. 


### Common Documents
No | Document
--- | ---------
1 | Taxpayer Registration Number
2 | National ID

### Documents for Foundation, or Donation Partner
No | Documents
--- | ---------
1 | Akta Pendirian Perusahaan
2 | Keputusan Dewan Pembina Yayasan
3 | Persetujuan Menhumham
4 | Taxpayer Registration Number Organization
5 | Izin Usaha
6 | Surat Keterangan Domisili
7 | Sertifikat Yayasan

### Documents for Other Company
No | Documents
--- | ---------
1 | Trade Business License
2 | Company's Deed
3 | Company Registration Certificate
4 | Decree of Minister Justine and Human Right

## VA aggregator Status
### Available Status for VA aggregator
Status | Description
------ | -----------
WAITING_PAYMENT | This status means that VA is active and can receive a payment
PAYMENT_DETECTED | This status means that there are incoming payments into the VA Number
EXPIRED | This status means that VA is expired. You cannot accept or make update to VA Number with this status.
STATIC_TRX_EXPIRED | This status means that the transaction is expired. If the VA has an unlimited lifetime, you can create a new transaction under the same VA using [Update VA endpoint](https://api-docs.oyindonesia.com/#update-va) .
COMPLETE | This status means that the VA is already closed/completed after successfully receiving a single payment. You cannot accept or make update to VA Number with this status. Only Static VA with attribute `is_single_use` true can have this status.
