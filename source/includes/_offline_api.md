# API Offline

API Offline enables your user to withdraw and deposit money from OY offline channel such as Cash Recycle Machine (CRM) and convenience store.

## Initiate Transaction

```shell
curl -X POST https://partner.oyindonesia.com/api-offline/initiate -H 'content-type: application/json, accept: application/json, x-oy-username:myuser, x-api-key:987654' -d '{"partner_tx_id": "withdraw_request_123", "receiver_phone_number": "081234567890", "amount": 50000, "transaction_type": "CASH_OUT", "offline_channel": "CRM"}'
```

> The above command returns JSON structured similar like this:

```json
{
    "status": {
        "code": "000",
        "message": "Success"
    },
    "amount": 50000,
    "code": "897412",
    "timestamp": "14-10-2020 17:12:16",
    "receiver_phone_number": "+6281234567890",
    "partner_trx_id": "withdrawal-request-123",
    "trx_id": "1234-5678",
    "transaction_type": "CASH_OUT",
    "inactive_at": "2020-10-14 13:12:16.786",
    "expired_at": "2020-10-15 10:12:16.786"
}
```

### HTTPS Request
`POST BASE_URL/api-offline/initiate`

### Request Parameters

Parameter | Type | Required | Description
--------- | ---- | -------- | -----------
partner_trx_id | String(255) | TRUE | Unique Payout ID for a specific request, generated by partner
receiver_phone_number | String(255) | TRUE | User's phone number that will be used for withdraw or deposit process
amount | BigDecimal | TRUE | The amount that going to withdraw or deposit
transaction_type | String(255) | TRUE | Type of transaction. CASH_OUT for withdrawal and CASH_IN for deposit.
offline_channel | String(255) | TRUE | Offline Channel which the transaction will be processed. 

### Response Parameters
 Parameter | Type | Description
--------- | ---- | -----------
status | Object | Status of Payout in Object `{code: <status_code>, message: <status_message>}`
partner_trx_id | String(255) | Unique Payout ID for a specific request, generated by partner.
trx_id | String(36) | Unique Payout ID from OY!. Partner can use this ID for settlement.
amount | BigDecimal | Amount of transaction (Accept non fraction number)
code | String(6) | Required unique code for Deposit or Withdrawal process
receiver_phone_number | String(255) | User's phone number that 
transaction_type | String(255) | Type of transaction. CASH_OUT for withdrawal and CASH_IN for deposit.
timestamp | String(19) | Execution time of Disbursement in OY! system ("yyyy-MM-dd HH:mm:ss.SSS")
inactive_at | String(19) | The time that the unique code will expire and need to be refreshed ("yyyy-MM-dd HH:mm:ss.SSS")
expired_at | String(19) | The time that the transaction will expire and won't be able to be withdrawn or deposited ("yyyy-MM-dd HH:mm:ss.SSS")

## Transaction Info

```shell
curl -X POST https://partner.oyindonesia.com/api/remit-status -H 'content-type: application/json, accept: application/json, x-oy-username:myuser, x-api-key:7654321' -d '{"partner_trx_id": "withdraw_request_123", "send_callback": "true"}'
```

> The above command returns JSON structured similar like this:

```json
{
    "status": {
        "code": "000",
        "message": "Success"
    },
    "amount": 50000,
    "code": "897412",
    "timestamp": "14-10-2020 17:12:16",
    "receiver_phone_number": "+6281234567890",
    "partner_trx_id": "withdrawal-request-123",
    "trx_id": "1234-5678",
    "transaction_type": "CASH_OUT",
    "inactive_at": "2020-10-14 13:12:16.786",
    "expired_at": "2020-10-15 10:12:16.786"
}
```

To get status of a transaction request, you can call this API. You may need to call this API few times until getting a final status (success / failed)

This API offers an option to send you a callback status of the transaction request to a specific URL.
Please contact us and submit a callback URL if you need a callback status of a transaction request.

### HTTPS Request
`POST BASE_URL/api-offline/tx-info`

### Request Parameters

Parameter | Type | Required | Description
--------- | ---- | -------- | -----------
partner_trx_id | String(255) | TRUE | Unique Payout ID for a specific request, generated by partner
send_callback | Boolean | FALSE | A flag to indiciate if the status of the transaction request need to be re-sent as a callback or not

### Response Parameters

Parameter | Type | Description
--------- | ---- | -----------
status | Object | Status of Payout in Object `{code: <status_code>, message: <status_message>}`
partner_trx_id | String(255) | Unique Payout ID for a specific request, generated by partner.
trx_id | String(36) | Unique Payout ID from OY!. Partner can use this ID for settlement.
amount | BigDecimal | Amount of transaction (Accept non fraction number)
code | String(6) | Required unique code for Deposit or Withdrawal Process
receiver_phone_number | String(255) | User's phone number that 
transaction_type | String(255) | Type of transaction. CASH_OUT for withdrawal and CASH_IN for deposit.
timestamp | String(19) | Execution time of Disbursement in OY! system ("yyyy-MM-dd HH:mm:ss.SSS")
inactive_at | String(19) | The time that the unique code will expire and need to be refreshed ("yyyy-MM-dd HH:mm:ss.SSS")
expired_at | String(19) | The time that the transaction will expire and won't be able to be withdrawn or deposited ("yyyy-MM-dd HH:mm:ss.SSS")

## Refresh Code

```shell
curl -X POST https://partner.oyindonesia.com/api/refresh-code -H 'content-type: application/json, accept: application/json, x-oy-username:myuser, x-api-key:7654321' -d '{"partner_trx_id": "withdraw_request_123"}'
```

> The above command returns JSON structured similar like this:

```json
{
    "status": {
        "code": "000",
        "message": "Success"
    },
    "code": "970524",
    "partner_tx_id": "withdraw_request_123",
    "inactive_at": "2020-10-14 13:12:16.786",
    "expired_at": "2020-10-15 10:12:16.786"
}
```

A transaction will be valid for 24 hours with a 3-hours validity for each unique code . Use this API to refresh the unique code that have expired in which transaction is still valid.

### HTTPS Request
`POST BASE_URL/api-offline/refresh-code`

### Request Parameters

Parameter | Type | Required | Description
--------- | ---- | -------- | -----------
partner_trx_id | String(255) | TRUE | Unique Payout ID for a specific request, generated by partner

### Response Parameters

Parameter | Type | Description
--------- | ---- | -----------
status | Object | Status of Payout in Object `{code: <status_code>, message: <status_message>}`
code | String(6) | Required unique code for Deposit or Withdrawal Process
partner_trx_id | String(255) | Unique Payout ID for a specific request, generated by partner
inactive_at | String(19) | The time that the unique code will expire and need to be refreshed ("yyyy-MM-dd HH:mm:ss.SSS")
expired_at | String(19) | The time that the transaction will expire and won't be able to be withdrawn or deposited ("yyyy-MM-dd HH:mm:ss.SSS")

## Callback

> Response callback:

```json
{
    "status": {
        "code": "000",
        "message": "Success"
    },
    "amount": 50000,
    "code": "897412",
    "timestamp": "14-10-2020 17:12:16",
    "receiver_phone_number": "+6281234567890",
    "partner_trx_id": "withdrawal-request-123",
    "trx_id": "1234-5678",
    "transaction_type": "CASH_OUT",
    "created_date": "2020-10-14 13:12:16.786",
    "last_updated_date": "2020-10-15 10:12:16.786"
}
```

Once a transaction request is finished, our system will make a callback status of that transaction request to your system

Please contact us and submit a callback URL if you need a callback status of a transaction request.

### Callback Parameters

Parameter | Type | Description
--------- | ---- | -----------
status | Object | Status of Payout in Object `{code: <status_code>, message: <status_message>}`
partner_trx_id | String(255) | Unique Payout ID for a specific request, generated by partner.
trx_id | String(36) | Unique Payout ID from OY!. Partner can use this ID for settlement.
amount | BigDecimal | Amount of transaction (Accept non fraction number)
code | String(6) | Required unique code for Deposit or Withdrawal process
receiver_phone_number | String(255) | User's phone number that 
transaction_type | String(255) | Type of transaction. CASH_OUT for withdrawal and CASH_IN for deposit.
timestamp | String(19) | Execution time of Disbursement in OY! system ("yyyy-MM-dd HH:mm:ss.SSS")
created_date | String(19) | Executionn time of trasaction in OY! system ("yyyy-MM-dd HH:mm:ss.SSS")
last_updated_date | String(19) | Latest status change of a transaction. Example from 'Pending' to 'Success' ("yyyy-MM-dd HH:mm:ss.SSS")

## API Offline Response Codes

These are the list of possible status codes for API Offline:

Payment Status | State | Meaning
---------- | ------- | -------
000 | Final | Transasction Request has been completed (SUCCESS)
102 | Non-Final | Request is In Progress (Waiting for Deposit or Withdrawal)
201 | Final | Request is Rejected (User ID is not Found)
202 | Final | Request is Rejected (User ID is not Active)
203 | Final | Request is Rejected (Duplicate Partner Tx ID)
204 | Final | Request is Rejected (Partner Tx ID is Not Found)
206 | Final | Request is Rejected (Partner Deposit Balance is Not Enough)
207 | Final | Request is Rejected (Request IP Address is not Registered)
208 | Final | Request is Rejected (API Key is not Valid)
215 | Final | Request is Rejected (Invalid denom amount request)
220 | Final | Request is Rejected (Offline channel is not valid or not elegible to process Withdrawal/Deposit Transaction)
221 | Final | Request is Rejected (Invalid transaction type)
222 | Final | Transaction is EXPIRED
224 | Final | Request is Rejected (Amount disburse does not reach Min amount)
225 | Final | Request is Rejected (Max amount per transaction exceed for disburse)
300 | Final | Transaction is FAILED

## API Offline Channel

These are the list of Oy! offline channel

Offline Channel | Transaction Type
---------- | -------
CRM | CASH IN, CASH OUT
ALFAMART | CASH OUT
